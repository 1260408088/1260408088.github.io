---
title: 狗东商城(一)
date: 2019-09-10 16:28:27
categories: [flutter]
tags: [项目,狗东商城]
---

# 一点废话

​		公司准备做App，一下子做两个端的。最终选择了flutter来完成，学的有段日子了，教程中的京东商城项目做的大约也有了一半了，随即来记录一下，不然这段日子岂不是又白学了。

# 开始

​		项目中的狗东商城（爱称），是最开始的b2c的版本。内容涉及的也较为广泛。大致就是下面的这种样子。

![](全局1.PNG)

![](全局2.PNG)

![](总体.PNG)

# 项目搭建

​		先搭建出大体的框架，然后在向里面填充。

## 	底部Tab页面

``` dart
import 'package:flutter/material.dart';
import '../../service/ScreenAdaper.dart';
import 'Cart.dart';
import 'Category.dart';
import 'Home.dart';
import 'User.dart';
class Tabs extends StatefulWidget {
  Tabs({Key key}) : super(key: key);
  _TabsState createState() => _TabsState();
}

class _TabsState extends State<Tabs> {
  PageController _pageController;

  @override
  void initState() {
    super.initState();
    this._pageController = new PageController(initialPage: this._currentIndex);
  }

  int _currentIndex = 0;
  // 存储页面的List
  List<Widget> _pageList = [
    HomePage(),
    CategoryPage(),
    CartPage(),
    UserPage(),
  ];

  @override
  Widget build(BuildContext context) {
    ScreenAdaper.init(context);
    return new Scaffold(
      body: PageView(
        controller: this._pageController,
        children: this._pageList,
        onPageChanged: (index) {
          setState(() {
            this._currentIndex = index;
          });
        },
        // physics: NeverScrollableScrollPhysics(), //禁止pageView滑动
      ), 
        // 底部的切换
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: this._currentIndex,
        onTap: (index) {
          setState(() { // 控制底部切换的事件
            this._currentIndex = index;
            this._pageController.jumpToPage(index);
          });
        },
        type: BottomNavigationBarType.fixed,
        fixedColor: Colors.red,
        items: [
          BottomNavigationBarItem(icon: Icon(Icons.home), title: Text("首页")),
          BottomNavigationBarItem(
              icon: Icon(Icons.category), title: Text("分类")),
          BottomNavigationBarItem(
              icon: Icon(Icons.shopping_cart), title: Text("购物车")),
          BottomNavigationBarItem(icon: Icon(Icons.people), title: Text("我的"))
        ],
      ),
    );
  }

 /*
  *
  * IndexedStack( // 切换页面状态的一种方法，但不适于精确的页面控制，在商城项目中不太适用（购物车模块需要更新的，但是，此种方法的加载是一次加载所有的页面）
        index: this._currentIndex,
        children: _pageList,
      ),
  */
}

```

## 	路由的切换

​		路由是统一管理的，在一个类中配置完全，然后在其他类中直接调用。(此种方便大型的项目，小项目适合普通路由)

``` dart
//配置路由
final routes = {
  '/': (context) => Tabs(),
  '/search': (context) => SearchPage(),
  '/productlist' :(context,{arguments}) => ProductList(arguments:arguments),
  '/search': (context) => SearchPage(),
  '/productContent': (context,{arguments}) => ProductContent(arguments:arguments),
};

//固定写法
var onGenerateRoute = (RouteSettings settings) {
// 统一处理
  final String name = settings.name;
  final Function pageContentBuilder = routes[name];
  if (pageContentBuilder != null) {
    if (settings.arguments != null) {
      final Route route = MaterialPageRoute(
          builder: (context) =>
              pageContentBuilder(context, arguments: settings.arguments));
      return route;
    } else {
      final Route route =
          MaterialPageRoute(builder: (context) => pageContentBuilder(context));
      return route;
    }
  }
};

```

## 页面的适配

​		为应对不同的设备，需要用到一个页面的适配的工具类，一般的设计原稿都是用的iphone6的尺寸。适配也是在ip6的基础上进行一定比例的放大或缩小。

引入适配的库：

``` yaml
flutter_screenutil: ^0.5.3
```

如何使用：

``` dart
import 'package:flutter_screenutil/flutter_screenutil.dart';
class ScreenAdaper{ // 屏幕适配器

  static init(context){ // 自定义了设计稿的宽高
    ScreenUtil.instance = ScreenUtil(width: 750, height: 1334)..init(context);
  }
  static height(double value){ // 设置高
     return ScreenUtil.getInstance().setHeight(value);
  }
  static width(double value){  // 设置宽
      return ScreenUtil.getInstance().setWidth(value);
  }
  static getScreenHeight(){ // 获得屏幕的高
    return ScreenUtil.screenHeightDp;
  }
  static getScreenWidth(){ // 获得屏幕的宽
    return ScreenUtil.screenWidthDp;
  }

  static size(double value){ // 设置字体的大小
    return ScreenUtil.getInstance().setSp(value);
  }
}
```

## 实体类的创建

​		移动端的大都接收json这种数据，但是将传递来的json数据渲染成为对应的实体类，如果一个个的来手写的话也是个体力活。所幸，有一个转换的[网站](https://javiercbk.github.io/json_to_dart/),方便快捷。复制正确的json数据格式，就能得到对应的实体。生成后，如果后期需要也是可以直接在里面添加字段的。

``` dart
// 商品的详情数据，单个显示，不存在数组
class ProductContentModel {
  ProductContentitem result;

  ProductContentModel({this.result});

  ProductContentModel.fromJson(Map<String, dynamic> json) {
    result =
    json['result'] != null ? new ProductContentitem.fromJson(json['result']) : null;
  }
  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    if (this.result != null) {
      data['result'] = this.result.toJson();
    }
    return data;
  }
}

class ProductContentitem {
  String sId;
  String title;
  String cid;
  Object price;
  String oldPrice;
  Object isBest;
  Object isHot;
  Object isNew;
  String status;
  String pic;
  String content;
  String cname;
  List<Attr> attr;
  String subTitle;
  // 新增，用于购物车数量添加
  int count;
  String selectedAttr;
  Object salecount;
  ProductContentitem(
      {this.sId,
        this.title,
        this.cid,
        this.price,
        this.oldPrice,
        this.isBest,
        this.isHot,
        this.isNew,
        this.status,
        this.pic,
        this.content,
        this.cname,
        this.attr,
        this.subTitle,
        this.count,
        this.salecount,
        this.selectedAttr });
  // 通俗来说就是将json字符串(dart的Map类型的数据)转换为List的
  ProductContentitem.fromJson(Map<String, dynamic> json) { 
    sId = json['_id'];
    title = json['title'];
    cid = json['cid'];
    price = json['price'];
    oldPrice = json['old_price'];
    isBest = json['is_best'];
    isHot = json['is_hot'];
    isNew = json['is_new'];
    status = json['status'];
    pic = json['pic'];
    content = json['content'];
    cname = json['cname'];
    if (json['attr'] != null) {
      attr = new List<Attr>();
      json['attr'].forEach((v) {
        attr.add(new Attr.fromJson(v));
      });
    }
    subTitle = json['sub_title'];
    salecount = json['salecount'];
    // 新增
    count=1;
    selectedAttr='';
  }
  // 将
  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    data['_id'] = this.sId;
    data['title'] = this.title;
    data['cid'] = this.cid;
    data['price'] = this.price;
    data['old_price'] = this.oldPrice;
    data['is_best'] = this.isBest;
    data['is_hot'] = this.isHot;
    data['is_new'] = this.isNew;
    data['status'] = this.status;
    data['pic'] = this.pic;
    data['content'] = this.content;
    data['cname'] = this.cname;
    if (this.attr != null) {
      data['attr'] = this.attr.map((v) => v.toJson()).toList();
    }
    data['sub_title'] = this.subTitle;
    data['salecount'] = this.salecount;
    return data;
  }
}

class Attr {
  String cate;
  List<String> list;
  List<Map> attrList;
  Attr({this.cate, this.list});

  Attr.fromJson(Map<String, dynamic> json) {
    cate = json['cate'];
    list = json['list'].cast<String>();
    attrList=[];
  }

  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    data['cate'] = this.cate;
    data['list'] = this.list;
    return data;
  }
}
```

商品列表的数据

``` dart
// 数组形式的数据,数据的解析有循环
class ProductModel {
  List<Result> result;

  ProductModel({this.result});

  ProductModel.fromJson(Map<String, dynamic> json) {
    if (json['result'] != null) {
      result = new List<Result>();
      json['result'].forEach((v) {
        result.add(new Result.fromJson(v));
      });
    }
  }

  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    if (this.result != null) {
      data['result'] = this.result.map((v) => v.toJson()).toList();
    }
    return data;
  }
}

class Result {
  String sId;
  String title;
  String cid;
  Object price;
  String oldPrice;
  String pic;
  String sPic;

  Result(
      {this.sId,
        this.title,
        this.cid,
        this.price,
        this.oldPrice,
        this.pic,
        this.sPic});

  Result.fromJson(Map<String, dynamic> json) {
    sId = json['_id'];
    title = json['title'];
    cid = json['cid'];
    price = json['price'];
    oldPrice = json['old_price'];
    pic = json['pic'];
    sPic = json['s_pic'];
  }

  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    data['_id'] = this.sId;
    data['title'] = this.title;
    data['cid'] = this.cid;
    data['price'] = this.price;
    data['old_price'] = this.oldPrice;
    data['pic'] = this.pic;
    data['s_pic'] = this.sPic;
    return data;
  }
}
```



